<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Miro AI Assistant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #f3f4f6;
        --surface: #ffffff;
        --border: #e5e7eb;
        --primary: #2563eb;
        --radius-lg: 18px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: var(--bg);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .app {
        background: var(--surface);
        border: 1px solid rgba(0,0,0,.03);
        box-shadow: 0 10px 40px rgba(15, 23, 42, 0.05);
        border-radius: 18px;
        width: min(100%, 840px);
        height: min(100vh - 20px, 640px);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .header {
        padding: 14px 18px 12px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .avatar {
        width: 34px;
        height: 34px;
        border-radius: 9999px;
        background: #dbeafe;
        display: grid;
        place-items: center;
        font-weight: 600;
        color: #1d4ed8;
        font-size: 0.85rem;
      }
      .title-wrap {
        display: flex;
        flex-direction: column;
      }
      .title {
        font-size: 0.9rem;
        font-weight: 600;
      }
      .subtitle {
        font-size: 0.7rem;
        color: #6b7280;
      }
      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
        margin-left: auto;
      }
      .chat {
        flex: 1;
        overflow-y: auto;
        padding: 14px 16px 8px;
        background: #eef2f7;
      }
      .msg-wrap {
        display: flex;
        margin-bottom: 12px;
        gap: 8px;
        max-width: 85%;
      }
      .msg-bot {
        justify-content: flex-start;
      }
      .msg-user {
        margin-left: auto;
        justify-content: flex-end;
      }
      .bubble {
        background: white;
        padding: 10px 12px 11px;
        border-radius: 14px;
        font-size: 0.8rem;
        line-height: 1.4;
        box-shadow: 0 1px 2px rgba(15,23,42,.03);
      }
      .bubble bot {
        white-space: pre-line;
      }
      .bubble.bot {
        border-top-left-radius: 4px;
      }
      .bubble.user {
        background: #2563eb;
        color: #fff;
        border-top-right-radius: 4px;
      }
      .input-bar {
        border-top: 1px solid var(--border);
        padding: 10px 12px;
        background: #fff;
        display: flex;
        gap: 8px;
      }
      .input-bar input {
        flex: 1;
        padding: 8px 10px;
        border-radius: 9999px;
        border: 1px solid #d1d5db;
        font-size: 0.78rem;
        outline: none;
      }
      .input-bar input:focus {
        border-color: #2563eb;
      }
      .input-bar button {
        background: #2563eb;
        border: none;
        color: white;
        border-radius: 9999px;
        padding: 8px 14px;
        font-size: 0.75rem;
        cursor: pointer;
      }
      .input-bar button:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }
      .typing {
        display: inline-flex;
        gap: 3px;
      }
      .dot {
        width: 5px;
        height: 5px;
        background: #94a3b8;
        border-radius: 50%;
        animation: blink 1s infinite;
      }
      .dot:nth-child(2) { animation-delay: .2s; }
      .dot:nth-child(3) { animation-delay: .4s; }
      @keyframes blink {
        0%, 100% { opacity: .2; transform: translateY(0); }
        50% { opacity: 1; transform: translateY(-2px); }
      }
      .error {
        background: #fee2e2;
        color: #b91c1c;
        border: 1px solid #fecaca;
        padding: 6px 10px;
        border-radius: 10px;
        font-size: 0.68rem;
        margin-bottom: 10px;
      }
      @media (max-width: 560px) {
        .app {
          width: 100%;
          height: 100vh;
          border-radius: 0;
        }
        .chat {
          padding: 10px 8px;
        }
        .msg-wrap {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="header">
        <div class="avatar">AI</div>
        <div class="title-wrap">
          <div class="title">Workshop Assistant</div>
          <div class="subtitle">Ask about course docs or tasks</div>
        </div>
        <div class="status-dot" title="online"></div>
      </div>
      <div id="chat" class="chat">
        <div class="msg-wrap msg-bot">
          <div class="avatar" style="width:26px;height:26px;font-size:.7rem;">AI</div>
          <div class="bubble bot">
            Hi ðŸ‘‹ Iâ€™m your assistant. Ask me something or send a document-related question.
          </div>
        </div>
      </div>
      <form class="input-bar" id="form">
        <input id="input" autocomplete="off" placeholder="Type your questionâ€¦" />
        <button id="sendBtn" type="submit">Send</button>
      </form>
    </div>

    <script>
      // 1) Put your real Make webhook here:
      const WEBHOOK_URL = "https://hook.eu1.make.com/YOUR_WEBHOOK_HERE";

      const chatEl = document.getElementById("chat");
      const inputEl = document.getElementById("input");
      const formEl = document.getElementById("form");
      const sendBtn = document.getElementById("sendBtn");

      // Helper: scroll to bottom
      function scrollToBottom() {
        chatEl.scrollTop = chatEl.scrollHeight;
      }

      // Add message to chat
      function addMessage(text, sender = "bot", isTyping = false) {
        const wrap = document.createElement("div");
        wrap.className = "msg-wrap " + (sender === "user" ? "msg-user" : "msg-bot");

        if (sender === "bot") {
          const av = document.createElement("div");
          av.className = "avatar";
          av.style.width = "26px";
          av.style.height = "26px";
          av.style.fontSize = ".7rem";
          av.textContent = "AI";
          wrap.appendChild(av);
        }

        const bubble = document.createElement("div");
        bubble.className = "bubble " + (sender === "user" ? "user" : "bot");

        if (isTyping) {
          const dots = document.createElement("div");
          dots.className = "typing";
          dots.innerHTML = '<span class="dot"></span><span class="dot"></span><span class="dot"></span>';
          bubble.appendChild(dots);
        } else {
          bubble.textContent = text;
        }

        wrap.appendChild(bubble);
        chatEl.appendChild(wrap);
        scrollToBottom();
        return wrap;
      }

      // show error bubble
      function addError(text) {
        const err = document.createElement("div");
        err.className = "error";
        err.textContent = text;
        chatEl.appendChild(err);
        scrollToBottom();
      }

      formEl.addEventListener("submit", async (e) => {
        e.preventDefault();
        const question = inputEl.value.trim();
        if (!question) return;
        // user message
        addMessage(question, "user");
        inputEl.value = "";
        inputEl.focus();

        // bot typing
        const typingWrap = addMessage("", "bot", true);
        sendBtn.disabled = true;

        try {
          const res = await fetch(WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ question })
          });

          let data;
          try {
            data = await res.json();
          } catch (err) {
            data = null;
          }

          // remove typing
          typingWrap.remove();

          if (!res.ok) {
            addError("Assistant error: " + res.statusText);
          } else {
            const answer = data && (data.answer || data.response || data.text);
            if (answer) {
              addMessage(answer, "bot");
            } else {
              addMessage("I got your question, but the backend didnâ€™t send an answer field.", "bot");
            }
          }
        } catch (err) {
          typingWrap.remove();
          addError("Network error â€“ check your Make webhook URL.");
        } finally {
          sendBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>

